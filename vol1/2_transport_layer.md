# 2.1 introduction
SCTP是流控制传输协议,是个比较新的协议
# 2.6 TCP连接建立和终止
## 建立连接:
1. 服务端必须准备就绪接受一个连接进来, 通常通过`socket, bind, listen`来实现, 也叫作被动打开
2. 客户端通过调用`connect`发出一个主动打开, 客户端TCP发送一个"同步"(SYN)段, 告诉服务器客户端要发送数据的初始序号. 通常SYN不会伴随这数据发送;只是包含了IP header, TCP header, 还可能包含TCP选项
3. 服务器必须承认(ACK)客户端的SYN并且服务器必须也发送自己的包含即将通过该连接发送的数据初始序列号的SYN. 服务器发送的SYN和ACK在同一个段中.
4. 客户端必须承认服务器的SYN
这种方式需要交换的包最少3个,因此称为三次握手

## TCP选项
每个SYN可以包含TCP选项, 通常有以下几种:
- MSS: maximum segment size. 发送端TCP使用接收端的MSS作为它发送的最大段大小
- window scale: TCP可以通告到其他TCP的最大窗口是65535, 因为对应的TCP header占16位。
- 时间戳：该选项用于高速连接方式由于过期、延时或重复引起的可能的数据冲突。

## 终止连接：
需要四步：
1. 一个应用首先调用`close`，我们称为主动关闭，这端发送一个FIN段，表示终止发送数据。
2. 接收FIN的另一端执行被动关闭。接收到的FIN被TCP确认. 这个FIN也被作为EOF传递给接收端，因为FIN的接收意味着接收端将不会在该连接上接收到任何数据。
3. 一段时间后，EOF接收端将`close`它的socket, 这会导致它的TCP也发送一个FIN.
4. 接收最终FIN的一端的TCP确认收到该FIN.

## TCP状态转换图
这些状态可以通过`netstat`显示

## TIME_WAIT
主动关闭连接端经历了这个状态，持续时间是2MSL, 通常1-4分钟。MSL是任何IP数据报在网络中生存的最长时间。
TIME_WAIT存在的两个原因:  
1. 可靠地实现TCP全双工连接终止
2. 允许老的重复段在网络中过期

# 2.9 端口号
TCP\UDP\SCTP都使用端口号来区别其他进程，是一个16位的整数。  
被IANA（因特网已分配数值权威）分成三部分：
1. 0~1023 由IANA分配和控制。特定的服务一般都会分配相同的端口号。比如指定80到一个web服务
2. 1024~49151 已注册的端口号，不受IANA控制，但是被登记过，以方便社区
3. 49152~65535 动态私有端口号，IANA不管理，通常称为临时端口，49152是65535的四分之三


